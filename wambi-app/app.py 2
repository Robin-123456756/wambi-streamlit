import streamlit as st
import cv2
from gtts import gTTS
import os

st.set_page_config(page_title="Wambi Scan", page_icon="ğŸ¤–")
st.title("ğŸ¤– Wambi Face Detection & Vital Prep")

start = st.button("Scan My Face")

if start:
    st.write("ğŸ“· Scanning webcam... Please hold still.")

    # Access webcam
    cap = cv2.VideoCapture(0)
    if not cap.isOpened():
        st.error("âŒ Camera not accessible.")
    else:
        ret, frame = cap.read()
        cap.release()

        if not ret:
            st.error("âŒ Failed to capture image.")
        else:
            gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
            face_cascade = cv2.CascadeClassifier(
                cv2.data.haarcascades + "haarcascade_frontalface_default.xml"
            )
            faces = face_cascade.detectMultiScale(gray, 1.1, 4)

            if len(faces) > 0:
                st.success("âœ… Face detected")
                message = "Hard Guy, your identity has been confirmed. Letâ€™s check your vitals."
            else:
                st.error("âŒ No face detected")
                message = "No face detected. Please try again."

            # Voice output using gTTS
            tts = gTTS(message)
            tts.save("wambi_voice.mp3")
            st.audio("wambi_voice.mp3", format="audio/mp3")

            st.image(frame, channels="BGR", caption="ğŸ“¸ Webcam Snapshot")
